---
title: "Generate a thumbnail from a video using FFmpeg"
sidebarTitle: "Generate a thumbnail with FFmpeg"
description: "This example shows you how to generate a thumbnail from a video using FFmpeg with Trigger.dev."
---

## Overview

This task uses FFmpeg to generate a thumbnail from a video at a specific time point.

## Key Features:

- Fetches a video from a given URL
-     Generates a thumbnail from the video at the 50% time point
- Sets the thumbnail size to 320x240 pixels
- Handles temporary file management by creating and cleaning up input and output files
- Returns the generated thumbnail buffer, the file path of the thumbnail, the original video size, and the thumbnail size

## Task code

```ts trigger/ffmpeg-extract-audio.ts
import os from "os";
import fetch from "node-fetch";
import fs from "fs/promises";
import path from "path";
import { logger, task } from "@trigger.dev/sdk/v3";
import ffmpeg from "fluent-ffmpeg";

export const ffmpegGenerateThumbnail = task({
  id: "ffmpeg-generate-thumbnail",
  run: async (payload: { videoUrl: string }, { ctx }) => {
    if (ctx.environment.type !== "DEVELOPMENT") {
      ffmpeg.setFfmpegPath("/usr/bin/ffmpeg");
      ffmpeg.setFfprobePath("/usr/bin/ffprobe");
    }
    const { videoUrl } = payload;

    // Generate temporary file names
    const tempDirectory = os.tmpdir();
    const tempInputPath = path.join(tempDirectory, `input_${Date.now()}.mp4`);
    const outputPath = path.join(tempDirectory, `thumbnail_${Date.now()}.jpg`);

    try {
      // Fetch the video
      const response = await fetch(videoUrl);
      const buffer = await response.buffer();
      await fs.writeFile(tempInputPath, buffer);

      // Generate the thumbnail
      await new Promise((resolve, reject) => {
        ffmpeg(tempInputPath)
          .screenshots({
            count: 1,
            folder: "/tmp",
            filename: path.basename(outputPath),
            size: "320x240",
            timemarks: ["50%"],
          })
          .on("end", resolve)
          .on("error", reject);
      });

      // Read the generated thumbnail
      const thumbnail = await fs.readFile(outputPath);

      // Get file sizes for comparison
      const originalSize = buffer.length;
      const thumbnailSize = thumbnail.length;

      // Clean up temporary files
      await fs.unlink(tempInputPath);

      // Log thumbnail generation results
      logger.log(`Original video size: ${originalSize} bytes`);
      logger.log(`Thumbnail size: ${thumbnailSize} bytes`);
      logger.log(`Thumbnail saved at: ${outputPath}`);

      // Return the thumbnail buffer, file path, and sizes
      return {
        thumbnailBuffer: thumbnail,
        thumbnailPath: outputPath,
        originalSize,
        thumbnailSize,
      };
    } catch (error) {
      logger.error("Error generating thumbnail:", { error });
      // Clean up files in case of error
      try {
        await fs.unlink(tempInputPath);
        await fs.unlink(outputPath);
      } catch (cleanupError) {
        logger.error("Error during cleanup:", { cleanupError });
      }
      throw error;
    }
  },
});
```
