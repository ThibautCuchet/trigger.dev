---
title: "Extract audio from a video using FFmpeg"
sidebarTitle: "Extract audio with FFmpeg"
description: "This example shows you how to extract audio from a video using FFmpeg with Trigger.dev."
---

## Overview

This task uses FFmpeg to extract audio from a video and convert it to the WAV format.

## Key Features:

- Fetches a video from a given URL
- Extracts the audio from the video
- Converts the extracted audio to the WAV format
- Handles temporary file management by creating and cleaning up input and output files
- Returns the extracted WAV audio buffer and the file path of the WAV file

## Task code

<Warning>
  When testing, make sure to provide a video URL that has audio. If the video does not contain
  audio, the task will fail.
</Warning>

```ts trigger/ffmpeg-extract-audio.ts
import fetch from "node-fetch";
import fs from "fs/promises";
import path from "path";
import { logger, task } from "@trigger.dev/sdk/v3";
import ffmpeg from "fluent-ffmpeg";
import os from "os";

export const ffmpegExtractAudio = task({
  id: "ffmpeg-extract-audio",
  run: async (payload: { videoUrl: string }, { ctx }) => {
    if (ctx.environment.type !== "DEVELOPMENT") {
      ffmpeg.setFfmpegPath("/usr/bin/ffmpeg");
      ffmpeg.setFfprobePath("/usr/bin/ffprobe");
    }
    const { videoUrl } = payload;

    // Generate temporary and output file names
    const tempDirectory = os.tmpdir();

    const tempInputPath = path.join(tempDirectory, `input_${Date.now()}.mp4`);
    const outputPath = path.join(tempDirectory, `output_${Date.now()}.wav`);

    try {
      // Fetch the video
      const response = await fetch(videoUrl);
      const buffer = await response.arrayBuffer();
      const videoBuffer = Buffer.from(buffer);

      // Save the video buffer to a temporary file
      await fs.writeFile(tempInputPath, videoBuffer);

      // Convert the video to WAV
      await new Promise((resolve, reject) => {
        ffmpeg(tempInputPath)
          .toFormat("wav")
          .save(outputPath)
          .on("end", () => {
            logger.log(`WAV file saved to ${outputPath}`);
            resolve(outputPath);
          })
          .on("error", (err) => {
            reject(err);
          });
      });

      // Read the WAV file
      const wavBuffer = await fs.readFile(outputPath);

      // Clean up temporary files
      await fs.unlink(tempInputPath);

      // Log the output file path
      logger.log(`Converted video saved at: ${outputPath}`);

      // Return the WAV buffer and file path
      return {
        wavBuffer,
        wavFilePath: outputPath,
      };
    } catch (error) {
      logger.error("Error converting video to WAV:", { error });
      // Clean up files in case of error
      try {
        await fs.unlink(tempInputPath);
        await fs.unlink(outputPath);
      } catch (cleanupError) {
        logger.error("Error during cleanup:", { cleanupError });
      }
      throw error;
    }
  },
});
```
